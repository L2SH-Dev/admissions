import{W as Ie,U as W,G as ue,r as C,o as de,w as ce,f as x,M as p,I as E,J as y,c as i,X as Re,N as f,O as _,P as I,R as H,Q as z,p as D,Y as fe,g as L,u as j,F as q,y as M,Z as ve,m as me,a as ge,b as We,d as He,e as Xe,_ as Ye,s as F,$ as Ae,a0 as he,a1 as Me,a2 as ye,n as be,v as De,a3 as Le,i as N,E as je,t as R,h as ze,a4 as Ge,a5 as ee,a6 as G,a7 as te}from"./index-C9OlV7N4.js";import{u as O}from"./profile-DlU0X8LR.js";import{V as Ue,a as qe,b as Oe,f as Fe,c as Ne,s as Je}from"./forwardRefs-D8tYIjEZ.js";import{a as ae,V as U}from"./VRow-BJC5J7Kf.js";import{j as A,h as P,k as oe,_ as Qe,g as Ze,l as Ke,n as et,o as tt,p as at,M as ot,q as nt,r as st,u as lt}from"./_plugin-vue_export-helper-fWhonGee.js";import{V as xe}from"./VContainer-C49pwpmX.js";import{V as it}from"./VEmptyState-C4-WdWxr.js";import{m as rt,u as ut}from"./lazy-D6UC0faB.js";import{m as dt,V as ne}from"./VSlideGroup-CCUxaY4J.js";import{u as ct}from"./scopeId-DVNI0gRN.js";import{V as se}from"./VAlert-DlGNgmAa.js";import{b as le}from"./route-block-B_A1xBdJ.js";import"./VAvatar-Dh5V0tnL.js";/* empty css              */const _e=Ie("exam",{state:()=>({availableExams:[],historyExams:[],updateTrigger:!1}),actions:{update(){this.updateTrigger=!this.updateTrigger,this.loadAvailable(),this.loadHistory()},async loadAvailable(){this.updateTrigger=!this.updateTrigger;const e=O();if(e.profile==null){this.availableExams=[];return}const{data:o,error:a}=await W.rpc("get_available_exams",{profile_id:e.profile.id});if(a)console.error(a),this.availableExams=[];else if(o){const t=o;this.availableExams=[t].flat().map(s=>({...s,exam_types:{title:s.title}}))}else this.availableExams=[]},async loadHistory(){this.updateTrigger=!this.updateTrigger;const e=O();if(e.profile==null){this.historyExams=[];return}const{data:o,error:a}=await W.rpc("get_history_exams",{profile_id:e.profile.id});if(a)console.error(a),this.historyExams=[];else if(o){const t=o;this.historyExams=[t].flat().map(s=>({...s,exam_types:{title:s.title}}))}else this.historyExams=[]}}}),ft={class:"text-h6 mb-1"},vt={class:"text-subtitle-1"},mt={class:"d-flex align-center mb-2"},gt={class:"d-flex align-center mb-2"},ht={class:"d-flex flex-column"},yt={class:"d-flex align-center mb-1"},bt={class:"pl-4 mt-2",style:{"border-left":"3px solid rgb(var(--v-theme-info))"}},xt=ue({__name:"ExamCard",props:{data:{}},setup(e){const o=e,a=O(),t=_e(),s=C(!1),u=C(null),n=C(!1),v=C(!1),c=C(!1),r=C(!1);de(()=>{w()}),ce(()=>t.updateTrigger,()=>{w()});const w=async()=>{s.value=!0,await Promise.all([V(),$(),X()]),s.value=!1},m=x(()=>o.data.exam_types.title.charAt(0).toUpperCase()+o.data.exam_types.title.slice(1)),g=x(()=>new Date(o.data.date)>new Date),b=x(()=>new Date(o.data.date).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})),h=x(()=>{if(u.value===null)return"primary";const l=u.value/o.data.capacity;return l>=.9?"error":l>=.7?"warning":"success"}),V=async()=>{if(!a.profile)return;const{data:l,error:d}=await W.from("exam_registrations").select("*").eq("exam_id",o.data.id).eq("profile_id",a.profile.id);d?console.error(d):l.length?n.value=!0:n.value=!1},$=async()=>{if(!a.profile)return;const{data:l,error:d}=await W.from("exam_registrations").select("*, exams(exam_type_id)").eq("profile_id",a.profile.id).eq("exams.exam_type_id",o.data.exam_type_id);d?console.error(d):r.value=l.length>0},X=async()=>{const{data:l,error:d}=await W.rpc("get_allocation",{e_id:o.data.id});d?console.error(d):u.value=l},S=async()=>{if(!a.profile)return;v.value=!0;const{error:l}=await W.from("exam_registrations").insert([{profile_id:a.profile.id,exam_id:o.data.id}]).select();l?console.error(l):t.update(),v.value=!1},k=async()=>{if(!a.profile)return;c.value=!0;const{error:l}=await W.from("exam_registrations").delete().eq("profile_id",a.profile.id).eq("exam_id",o.data.id);l?console.error(l):t.update(),c.value=!1};return(l,d)=>(p(),E(xe,null,{default:y(()=>[i(Ue,{class:Re({"registered-border":f(n)})},{default:y(()=>[i(qe,null,{default:y(()=>[i(ae,{align:"center","no-gutters":"",justify:"space-between"},{default:y(()=>[i(U,{cols:"12",sm:"6"},{default:y(()=>[_("div",ft,I(f(m)),1),_("div",vt,[i(A,{icon:"mdi-school",class:"mr-2"}),_("span",null,I(l.data.grade)+" класс",1)])]),_:1}),i(U,{class:"d-flex justify-end mt-2 mb-2"},{default:y(()=>[f(n)?z("",!0):(p(),E(P,{key:0,color:"primary",variant:"tonal",loading:f(v),disabled:f(r),onClick:S},{default:y(()=>[H(I(f(r)?"Выбран другой слот":"Записаться"),1)]),_:1},8,["loading","disabled"])),f(n)&&f(g)?(p(),E(P,{key:1,color:"error",variant:"tonal",loading:f(c),onClick:k},{default:y(()=>d[0]||(d[0]=[H(" Отказаться ")])),_:1},8,["loading"])):z("",!0),f(n)&&new Date(l.data.date)<new Date?(p(),E(P,{key:2,color:"info",variant:"tonal",disabled:""},{default:y(()=>d[1]||(d[1]=[H(" Результат ")])),_:1})):z("",!0)]),_:1})]),_:1})]),_:1}),i(Oe,null,{default:y(()=>[i(ae,null,{default:y(()=>[i(U,{cols:"12",sm:"6"},{default:y(()=>[_("div",mt,[i(A,{icon:"mdi-calendar",class:"mr-2"}),_("span",null,I(f(b)),1)]),_("div",gt,[i(A,{icon:"mdi-clock-outline",class:"mr-2"}),_("span",null,I(l.data.start_time.slice(0,-3))+" - "+I(l.data.end_time.slice(0,-3)),1)])]),_:1}),i(U,{sm:"6"},{default:y(()=>[_("div",ht,[_("div",yt,[i(A,{icon:"mdi-account-group",class:"mr-2"}),_("span",null,I(f(u)===null?"...":`${f(u)}/${l.data.capacity}`)+" мест ",1)]),f(u)!==null?(p(),E(oe,{key:0,"model-value":f(u)/l.data.capacity*100,color:f(h),height:"8"},null,8,["model-value","color"])):(p(),E(oe,{key:1,indeterminate:""}))])]),_:1})]),_:1}),_("p",bt,I(l.data.annotation),1)]),_:1})]),_:1},8,["class"])]),_:1}))}}),_t=Qe(xt,[["__scopeId","data-v-d2f7f7ce"]]),Z=Symbol.for("vuetify:v-tabs"),wt=D({fixed:Boolean,sliderColor:String,hideSlider:Boolean,direction:{type:String,default:"horizontal"},...fe(Ze({selectedClass:"v-tab--selected",variant:"text"}),["active","block","flat","location","position","symbol"])},"VTab"),J=L()({name:"VTab",props:wt(),setup(e,o){let{slots:a,attrs:t}=o;const{textColorClasses:s,textColorStyles:u}=Ke(e,"sliderColor"),n=C(),v=C(),c=x(()=>e.direction==="horizontal"),r=x(()=>{var m,g;return((g=(m=n.value)==null?void 0:m.group)==null?void 0:g.isSelected.value)??!1});function w(m){var b,h;let{value:g}=m;if(g){const V=(h=(b=n.value)==null?void 0:b.$el.parentElement)==null?void 0:h.querySelector(".v-tab--selected .v-tab__slider"),$=v.value;if(!V||!$)return;const X=getComputedStyle(V).color,S=V.getBoundingClientRect(),k=$.getBoundingClientRect(),l=c.value?"x":"y",d=c.value?"X":"Y",T=c.value?"right":"bottom",B=c.value?"width":"height",ke=S[l],Ee=k[l],Y=ke>Ee?S[T]-k[T]:S[l]-k[l],Be=Math.sign(Y)>0?c.value?"right":"bottom":Math.sign(Y)<0?c.value?"left":"top":"center",Pe=(Math.abs(Y)+(Math.sign(Y)<0?S[B]:k[B]))/Math.max(S[B],k[B])||0,$e=S[B]/k[B]||0,K=1.5;Ne($,{backgroundColor:[X,"currentcolor"],transform:[`translate${d}(${Y}px) scale${d}(${$e})`,`translate${d}(${Y/K}px) scale${d}(${(Pe-1)/K+1})`,"none"],transformOrigin:Array(3).fill(Be)},{duration:225,easing:Je})}}return j(()=>{const m=P.filterProps(e);return i(P,M({symbol:Z,ref:n,class:["v-tab",e.class],style:e.style,tabindex:r.value?0:-1,role:"tab","aria-selected":String(r.value),active:!1},m,t,{block:e.fixed,maxWidth:e.fixed?300:void 0,"onGroup:selected":w}),{...a,default:()=>{var g;return i(q,null,[((g=a.default)==null?void 0:g.call(a))??e.text,!e.hideSlider&&i("div",{ref:v,class:["v-tab__slider",s.value],style:u.value},null)])}})}),Fe({},n)}}),Vt=e=>{const{touchstartX:o,touchendX:a,touchstartY:t,touchendY:s}=e,u=.5,n=16;e.offsetX=a-o,e.offsetY=s-t,Math.abs(e.offsetY)<u*Math.abs(e.offsetX)&&(e.left&&a<o-n&&e.left(e),e.right&&a>o+n&&e.right(e)),Math.abs(e.offsetX)<u*Math.abs(e.offsetY)&&(e.up&&s<t-n&&e.up(e),e.down&&s>t+n&&e.down(e))};function pt(e,o){var t;const a=e.changedTouches[0];o.touchstartX=a.clientX,o.touchstartY=a.clientY,(t=o.start)==null||t.call(o,{originalEvent:e,...o})}function Ct(e,o){var t;const a=e.changedTouches[0];o.touchendX=a.clientX,o.touchendY=a.clientY,(t=o.end)==null||t.call(o,{originalEvent:e,...o}),Vt(o)}function Tt(e,o){var t;const a=e.changedTouches[0];o.touchmoveX=a.clientX,o.touchmoveY=a.clientY,(t=o.move)==null||t.call(o,{originalEvent:e,...o})}function St(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const o={touchstartX:0,touchstartY:0,touchendX:0,touchendY:0,touchmoveX:0,touchmoveY:0,offsetX:0,offsetY:0,left:e.left,right:e.right,up:e.up,down:e.down,start:e.start,move:e.move,end:e.end};return{touchstart:a=>pt(a,o),touchend:a=>Ct(a,o),touchmove:a=>Tt(a,o)}}function kt(e,o){var v;const a=o.value,t=a!=null&&a.parent?e.parentElement:e,s=(a==null?void 0:a.options)??{passive:!0},u=(v=o.instance)==null?void 0:v.$.uid;if(!t||!u)return;const n=St(o.value);t._touchHandlers=t._touchHandlers??Object.create(null),t._touchHandlers[u]=n,ve(n).forEach(c=>{t.addEventListener(c,n[c],s)})}function Et(e,o){var u,n;const a=(u=o.value)!=null&&u.parent?e.parentElement:e,t=(n=o.instance)==null?void 0:n.$.uid;if(!(a!=null&&a._touchHandlers)||!t)return;const s=a._touchHandlers[t];ve(s).forEach(v=>{a.removeEventListener(v,s[v])}),delete a._touchHandlers[t]}const we={mounted:kt,unmounted:Et},Ve=Symbol.for("vuetify:v-window"),pe=Symbol.for("vuetify:v-window-group"),Ce=D({continuous:Boolean,nextIcon:{type:[Boolean,String,Function,Object],default:"$next"},prevIcon:{type:[Boolean,String,Function,Object],default:"$prev"},reverse:Boolean,showArrows:{type:[Boolean,String],validator:e=>typeof e=="boolean"||e==="hover"},touch:{type:[Object,Boolean],default:void 0},direction:{type:String,default:"horizontal"},modelValue:null,disabled:Boolean,selectedClass:{type:String,default:"v-window-item--active"},mandatory:{type:[Boolean,String],default:"force"},...me(),...ge(),...We()},"VWindow"),ie=L()({name:"VWindow",directives:{Touch:we},props:Ce(),emits:{"update:modelValue":e=>!0},setup(e,o){let{slots:a}=o;const{themeClasses:t}=He(e),{isRtl:s}=Xe(),{t:u}=Ye(),n=et(e,pe),v=C(),c=x(()=>s.value?!e.reverse:e.reverse),r=F(!1),w=x(()=>{const l=e.direction==="vertical"?"y":"x",T=(c.value?!r.value:r.value)?"-reverse":"";return`v-window-${l}${T}-transition`}),m=F(0),g=C(void 0),b=x(()=>n.items.value.findIndex(l=>n.selected.value.includes(l.id)));ce(b,(l,d)=>{const T=n.items.value.length,B=T-1;T<=2?r.value=l<d:l===B&&d===0?r.value=!0:l===0&&d===B?r.value=!1:r.value=l<d}),Ae(Ve,{transition:w,isReversed:r,transitionCount:m,transitionHeight:g,rootRef:v});const h=x(()=>e.continuous||b.value!==0),V=x(()=>e.continuous||b.value!==n.items.value.length-1);function $(){h.value&&n.prev()}function X(){V.value&&n.next()}const S=x(()=>{const l=[],d={icon:s.value?e.nextIcon:e.prevIcon,class:`v-window__${c.value?"right":"left"}`,onClick:n.prev,"aria-label":u("$vuetify.carousel.prev")};l.push(h.value?a.prev?a.prev({props:d}):i(P,d,null):i("div",null,null));const T={icon:s.value?e.prevIcon:e.nextIcon,class:`v-window__${c.value?"left":"right"}`,onClick:n.next,"aria-label":u("$vuetify.carousel.next")};return l.push(V.value?a.next?a.next({props:T}):i(P,T,null):i("div",null,null)),l}),k=x(()=>e.touch===!1?e.touch:{...{left:()=>{c.value?$():X()},right:()=>{c.value?X():$()},start:d=>{let{originalEvent:T}=d;T.stopPropagation()}},...e.touch===!0?{}:e.touch});return j(()=>he(i(e.tag,{ref:v,class:["v-window",{"v-window--show-arrows-on-hover":e.showArrows==="hover"},t.value,e.class],style:e.style},{default:()=>{var l,d;return[i("div",{class:"v-window__container",style:{height:g.value}},[(l=a.default)==null?void 0:l.call(a,{group:n}),e.showArrows!==!1&&i("div",{class:"v-window__controls"},[S.value])]),(d=a.additional)==null?void 0:d.call(a,{group:n})]}}),[[Me("touch"),k.value]])),{group:n}}}),Bt=D({...fe(Ce(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VTabsWindow"),Te=L()({name:"VTabsWindow",props:Bt(),emits:{"update:modelValue":e=>!0},setup(e,o){let{slots:a}=o;const t=ye(Z,null),s=be(e,"modelValue"),u=x({get(){var n;return s.value!=null||!t?s.value:(n=t.items.value.find(v=>t.selected.value.includes(v.id)))==null?void 0:n.value},set(n){s.value=n}});return j(()=>{const n=ie.filterProps(e);return i(ie,M({_as:"VTabsWindow"},n,{modelValue:u.value,"onUpdate:modelValue":v=>u.value=v,class:["v-tabs-window",e.class],style:e.style,mandatory:!1,touch:!1}),a)}),{}}}),Se=D({reverseTransition:{type:[Boolean,String],default:void 0},transition:{type:[Boolean,String],default:void 0},...me(),...tt(),...rt()},"VWindowItem"),re=L()({name:"VWindowItem",directives:{Touch:we},props:Se(),emits:{"group:selected":e=>!0},setup(e,o){let{slots:a}=o;const t=ye(Ve),s=at(e,pe),{isBooted:u}=De();if(!t||!s)throw new Error("[Vuetify] VWindowItem must be used inside VWindow");const n=F(!1),v=x(()=>u.value&&(t.isReversed.value?e.reverseTransition!==!1:e.transition!==!1));function c(){!n.value||!t||(n.value=!1,t.transitionCount.value>0&&(t.transitionCount.value-=1,t.transitionCount.value===0&&(t.transitionHeight.value=void 0)))}function r(){var h;n.value||!t||(n.value=!0,t.transitionCount.value===0&&(t.transitionHeight.value=N((h=t.rootRef.value)==null?void 0:h.clientHeight)),t.transitionCount.value+=1)}function w(){c()}function m(h){n.value&&je(()=>{!v.value||!n.value||!t||(t.transitionHeight.value=N(h.clientHeight))})}const g=x(()=>{const h=t.isReversed.value?e.reverseTransition:e.transition;return v.value?{name:typeof h!="string"?t.transition.value:h,onBeforeEnter:r,onAfterEnter:c,onEnterCancelled:w,onBeforeLeave:r,onAfterLeave:c,onLeaveCancelled:w,onEnter:m}:!1}),{hasContent:b}=ut(e,s.isSelected);return j(()=>i(ot,{transition:g.value,disabled:!u.value},{default:()=>{var h;return[he(i("div",{class:["v-window-item",s.selectedClass.value,e.class],style:e.style},[b.value&&((h=a.default)==null?void 0:h.call(a))]),[[Le,s.isSelected.value]])]}})),{groupItem:s}}}),Pt=D({...Se()},"VTabsWindowItem"),Q=L()({name:"VTabsWindowItem",props:Pt(),setup(e,o){let{slots:a}=o;return j(()=>{const t=re.filterProps(e);return i(re,M({_as:"VTabsWindowItem"},t,{class:["v-tabs-window-item",e.class],style:e.style}),a)}),{}}});function $t(e){return e?e.map(o=>Ge(o)?o:{text:o,value:o}):[]}const It=D({alignTabs:{type:String,default:"start"},color:String,fixedTabs:Boolean,items:{type:Array,default:()=>[]},stacked:Boolean,bgColor:String,grow:Boolean,height:{type:[Number,String],default:void 0},hideSlider:Boolean,sliderColor:String,...dt({mandatory:"force",selectedClass:"v-tab-item--selected"}),...nt(),...ge()},"VTabs"),Rt=L()({name:"VTabs",props:It(),emits:{"update:modelValue":e=>!0},setup(e,o){let{attrs:a,slots:t}=o;const s=be(e,"modelValue"),u=x(()=>$t(e.items)),{densityClasses:n}=st(e),{backgroundColorClasses:v,backgroundColorStyles:c}=lt(R(e,"bgColor")),{scopeId:r}=ct();return ze({VTab:{color:R(e,"color"),direction:R(e,"direction"),stacked:R(e,"stacked"),fixed:R(e,"fixedTabs"),sliderColor:R(e,"sliderColor"),hideSlider:R(e,"hideSlider")}}),j(()=>{const w=ne.filterProps(e),m=!!(t.window||e.items.length>0);return i(q,null,[i(ne,M(w,{modelValue:s.value,"onUpdate:modelValue":g=>s.value=g,class:["v-tabs",`v-tabs--${e.direction}`,`v-tabs--align-tabs-${e.alignTabs}`,{"v-tabs--fixed-tabs":e.fixedTabs,"v-tabs--grow":e.grow,"v-tabs--stacked":e.stacked},n.value,v.value,e.class],style:[{"--v-tabs-height":N(e.height)},c.value,e.style],role:"tablist",symbol:Z},r,a),{default:()=>{var g;return[((g=t.default)==null?void 0:g.call(t))??u.value.map(b=>{var h;return((h=t.tab)==null?void 0:h.call(t,{item:b}))??i(J,M(b,{key:b.text,value:b.value}),{default:t[`tab.${b.value}`]?()=>{var V;return(V=t[`tab.${b.value}`])==null?void 0:V.call(t,{item:b})}:void 0})})]}}),m&&i(Te,M({modelValue:s.value,"onUpdate:modelValue":g=>s.value=g,key:"tabs-window"},r),{default:()=>{var g;return[u.value.map(b=>{var h;return((h=t.item)==null?void 0:h.call(t,{item:b}))??i(Q,{value:b.value},{default:()=>{var V;return(V=t[`item.${b.value}`])==null?void 0:V.call(t,{item:b})}})}),(g=t.window)==null?void 0:g.call(t)]}})])}),{}}}),Wt={class:"d-flex align-center justify-space-between mb-4"},Ht={class:"d-flex align-center justify-space-between mb-4"},Xt=ue({__name:"exams",setup(e){const o=O(),a=_e(),t=C("available"),s=C(!0),u=C(!0);de(()=>{n(),v()});const n=async()=>{s.value=!0,await a.loadAvailable(),s.value=!1},v=async()=>{u.value=!0,await a.loadHistory(),u.value=!1};return(c,r)=>{const w=_t;return f(o).profile===null?(p(),E(it,{key:0,icon:"mdi-book-open-variant",text:"Выберите профиль для просмотра экзаменов",title:"Не выбран профиль","action-text":"Выбрать профиль","onClick:action":r[0]||(r[0]=()=>c.$router.push("/profiles"))})):(p(),E(xe,{key:1},{default:y(()=>[i(Rt,{modelValue:f(t),"onUpdate:modelValue":r[1]||(r[1]=m=>ee(t)?t.value=m:null)},{default:y(()=>[i(J,{value:"available"},{default:y(()=>r[3]||(r[3]=[H("Доступные")])),_:1}),i(J,{value:"mine"},{default:y(()=>r[4]||(r[4]=[H("Мои экзамены")])),_:1})]),_:1},8,["modelValue"]),i(Te,{modelValue:f(t),"onUpdate:modelValue":r[2]||(r[2]=m=>ee(t)?t.value=m:null),class:"pt-4"},{default:y(()=>[i(Q,{value:"available"},{default:y(()=>[_("div",Wt,[i(P,{color:"primary",icon:c.$vuetify.display.xs,variant:"tonal",loading:f(s),disabled:f(s),onClick:n},{default:y(()=>[i(A,null,{default:y(()=>r[5]||(r[5]=[H("mdi-refresh")])),_:1}),r[6]||(r[6]=_("span",{class:"d-none d-sm-inline ml-2"},"Обновить",-1))]),_:1},8,["icon","loading","disabled"])]),f(a).availableExams.length?(p(!0),G(q,{key:0},te(f(a).availableExams,m=>(p(),G("div",{key:m.id},[i(w,{data:m},null,8,["data"])]))),128)):f(s)?z("",!0):(p(),E(se,{key:1,type:"info",text:"Нет доступных экзаменов"}))]),_:1}),i(Q,{value:"mine"},{default:y(()=>[_("div",Ht,[i(P,{color:"primary",icon:c.$vuetify.display.xs,variant:"tonal",loading:f(u),disabled:f(u),onClick:v},{default:y(()=>[i(A,null,{default:y(()=>r[7]||(r[7]=[H("mdi-refresh")])),_:1}),r[8]||(r[8]=_("span",{class:"d-none d-sm-inline ml-2"},"Обновить",-1))]),_:1},8,["icon","loading","disabled"])]),f(a).historyExams.length?(p(!0),G(q,{key:0},te(f(a).historyExams,m=>(p(),G("div",{key:m.id},[i(w,{data:m},null,8,["data"])]))),128)):f(u)?z("",!0):(p(),E(se,{key:1,type:"info",text:"Нет истории экзаменов"}))]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}});typeof le=="function"&&le(Xt);export{Xt as default};
