import{G as p,U as i,M as V,a6 as w,c as a,J as s,R as t,O as g,a8 as b,P as n,F as y}from"./index-C9OlV7N4.js";import{_ as k,h as u,j as m}from"./_plugin-vue_export-helper-fWhonGee.js";import{V as h,d as C,e as $}from"./forwardRefs-D8tYIjEZ.js";import{V as v,a as f}from"./VTextField-DXc2Quau.js";import{V as E}from"./VContainer-C49pwpmX.js";import{V as S}from"./VSnackbar-gJiRxyij.js";import"./VAvatar-Dh5V0tnL.js";/* empty css              */import"./VOverlay-D2KH32Jk.js";import"./getScrollParent-D9sK-TVl.js";import"./delay-CcW5OwbF.js";import"./lazy-D6UC0faB.js";import"./scopeId-DVNI0gRN.js";const q=p({data(){return{email:"",password:"",passwordVisible:!1,rules:{required:e=>!!e||"Обязательное поле",email:e=>/.+@.+\..+/.test(e)||"Email должен быть действительным"},errorSnackbar:!1,errorText:"",loading:!1}},methods:{async login(){if(!(await this.$refs.form.validate()).valid)return;this.loading=!0;const{error:r}=await i.auth.signInWithPassword({email:this.email,password:this.password});this.loading=!1,r?(this.errorText=r.message,this.errorSnackbar=!0):this.redirect()},async redirect(){await this.checkAdmin()&&(console.warn("Admins are not allowed to login"),await i.auth.signOut()),this.$route.query.redirect?this.$router.push(this.$route.query.redirect):this.$router.push("/profiles")},async checkAdmin(){const{data:{user:e}}=await i.auth.getUser();if(!e)return!1;const{data:r,error:l}=await i.from("user_roles").select("role").eq("user_id",e.id);return l?(console.error(l),!1):!!r.some(d=>d.role==="admin")}}});function A(e,r,l,d,F,T){return V(),w(y,null,[a(E,{class:"fill-height d-flex align-center justify-center"},{default:s(()=>[a(h,{class:"pa-5","max-width":"500",width:"100%",loading:e.loading},{default:s(()=>[a(C,null,{default:s(()=>[a(u,{icon:"",color:"grey",to:"/",variant:"text"},{default:s(()=>[a(m,null,{default:s(()=>r[5]||(r[5]=[t("mdi-arrow-left")])),_:1}),r[6]||(r[6]=t(" Назад "))]),_:1}),r[7]||(r[7]=g("h1",{class:"text-center flex-grow-1"},"Вход",-1))]),_:1}),a(v,{ref:"form",onSubmit:r[3]||(r[3]=b(()=>{},["prevent"]))},{default:s(()=>[a(f,{modelValue:e.email,"onUpdate:modelValue":r[0]||(r[0]=o=>e.email=o),label:"Email",rules:[e.rules.required,e.rules.email]},null,8,["modelValue","rules"]),a(f,{modelValue:e.password,"onUpdate:modelValue":r[2]||(r[2]=o=>e.password=o),label:"Пароль",type:e.passwordVisible?"text":"password",rules:[e.rules.required]},{"append-inner":s(()=>[a(m,{onClick:r[1]||(r[1]=o=>e.passwordVisible=!e.passwordVisible)},{default:s(()=>[t(n(e.passwordVisible?"mdi-eye-off":"mdi-eye"),1)]),_:1})]),_:1},8,["modelValue","type","rules"]),a(u,{color:"primary",type:"submit",class:"mt-4 mx-auto d-block",disabled:e.loading,onClick:e.login},{default:s(()=>r[8]||(r[8]=[t(" Войти ")])),_:1},8,["disabled","onClick"])]),_:1},512),a($,null,{default:s(()=>[a(u,{color:"secondary",to:"/register",class:"mt-4 mx-auto",variant:"text"},{default:s(()=>r[9]||(r[9]=[t(" Нет аккаунта? Зарегистрироваться ")])),_:1})]),_:1})]),_:1},8,["loading"])]),_:1}),a(S,{modelValue:e.errorSnackbar,"onUpdate:modelValue":r[4]||(r[4]=o=>e.errorSnackbar=o),timeout:5e3,color:"error"},{default:s(()=>[t(n(e.errorText),1)]),_:1},8,["modelValue"])],64)}const R=k(q,[["render",A],["__scopeId","data-v-f892b13e"]]);export{R as default};
